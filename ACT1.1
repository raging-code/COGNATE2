#!/usr/bin/env python3
"""
Activity 1: LED Sequence Control for Raspberry Pi 5
Using GPIO Zero - Tested and working
"""

from gpiozero import Button, LED
import time
from signal import pause

# ========== GPIO PIN SETUP ==========
BUTTON_PIN = 14      # GPIO14 for button
GREEN_LED_PIN = 15   # GPIO15 for green LED  
YELLOW_LED_PIN = 16  # GPIO16 for yellow LED
RED_LED_PIN = 17     # GPIO17 for red LED

# Timing constants
YELLOW_TIME = 3      # 3 seconds
RED_TIME = 10        # 10 seconds

# ========== INITIALIZE COMPONENTS ==========
print("Initializing GPIO components...")
button = Button(BUTTON_PIN, pull_up=True, bounce_time=0.3)
green = LED(GREEN_LED_PIN)
yellow = LED(YELLOW_LED_PIN)
red = LED(RED_LED_PIN)

# ========== LED CONTROL FUNCTIONS ==========
def all_leds_off():
    """Turn off all LEDs"""
    green.off()
    yellow.off()
    red.off()

def green_on():
    """Turn on green LED only"""
    all_leds_off()
    green.on()
    print("Green LED ON")

def yellow_on():
    """Turn on yellow LED only"""
    all_leds_off()
    yellow.on()
    print("Yellow LED ON")

def red_on():
    """Turn on red LED only"""
    all_leds_off()
    red.on()
    print("Red LED ON")

# ========== SEQUENCE FUNCTION ==========
def run_sequence():
    """Run the complete LED sequence"""
    print("\n" + "="*40)
    print("STARTING SEQUENCE")
    print("="*40)
    
    # Step 1: Yellow for 3 seconds
    yellow_on()
    print(f"Yellow LED: {YELLOW_TIME} seconds")
    for i in range(YELLOW_TIME, 0, -1):
        print(f"  {i}...")
        time.sleep(1)
    
    # Step 2: Red for 10 seconds
    red_on()
    print(f"\nRed LED: {RED_TIME} seconds")
    for i in range(RED_TIME, 0, -1):
        print(f"  {i}...")
        time.sleep(1)
    
    # Step 3: Back to green
    green_on()
    print("\n✓ Sequence complete!")
    print("Ready for next button press")
    print("="*40 + "\n")

# ========== BUTTON HANDLER ==========
def button_pressed():
    """Handle button press event"""
    print(f"\n[{time.strftime('%H:%M:%S')}] Button pressed - Starting sequence")
    run_sequence()

def button_released():
    """Handle button release event"""
    print(f"[{time.strftime('%H:%M:%S')}] Button released")

# ========== MAIN PROGRAM ==========
def main():
    print("="*50)
    print("LED SEQUENCE CONTROLLER - RASPBERRY PI 5")
    print("="*50)
    print("GPIO Pins:")
    print(f"  Button: GPIO{BUTTON_PIN} (connects to GND when pressed)")
    print(f"  Green LED: GPIO{GREEN_LED_PIN}")
    print(f"  Yellow LED: GPIO{YELLOW_LED_PIN}")
    print(f"  Red LED: GPIO{RED_LED_PIN}")
    print("="*50)
    print("\nWIRING INSTRUCTIONS:")
    print("1. Connect one side of button to GPIO14 (Pin 8)")
    print("2. Connect other side to GND (Pin 6)")
    print("3. LEDs: GPIO -> Resistor (220-330Ω) -> LED+ -> LED- -> GND")
    print("="*50)
    
    # Set initial state
    green_on()
    print("\nSystem ready!")
    print("Press the button to start sequence...")
    
    # Set button events - using when_pressed (on press down)
    button.when_pressed = button_pressed
    button.when_released = button_released
    
    # Alternative: Use simple state monitoring for debugging
    def monitor_button():
        """Monitor button state for debugging"""
        last_state = button.is_pressed
        press_count = 0
        
        try:
            while True:
                current_state = button.is_pressed
                
                if current_state and not last_state:
                    press_count += 1
                    print(f"[{time.strftime('%H:%M:%S')}] Button PRESSED (Count: {press_count})")
                elif not current_state and last_state:
                    print(f"[{time.strftime('%H:%M:%S')}] Button RELEASED")
                
                last_state = current_state
                time.sleep(0.01)
                
        except KeyboardInterrupt:
            pass
    
    try:
        # Keep program running
        print(f"\n[{time.strftime('%H:%M:%S')}] Waiting for button press...")
        print("Press Ctrl+C to exit")
        pause()
        
    except KeyboardInterrupt:
        print("\n\nProgram stopped by user")
    finally:
        # Cleanup
        all_leds_off()
        print("All LEDs turned off")
        print("Goodbye!")

# ========== START PROGRAM ==========
if __name__ == "__main__":
    main()
