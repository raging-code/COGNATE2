from gpiozero import LED, Button
import time
import random

# Set up GPIO pins
LED_PIN = 4          # GPIO pin for LED
BUTTON_P1 = 14       # GPIO pin for Player 1 button
BUTTON_P2 = 15       # GPIO pin for Player 2 button

# Initialize components
led = LED(LED_PIN)
player1_button = Button(BUTTON_P1, pull_up=True)
player2_button = Button(BUTTON_P2, pull_up=True)

# Game state variables
blinking_active = False
winner = None

def play_game():
    global blinking_active, winner
    
    # Reset
    winner = None
    blinking_active = True
    led.off()
    
    # Random wait before blinking
    time.sleep(random.uniform(1, 3))
    
    print("\n" + "="*40)
    print("LED BLINKING STARTED")
    print("="*40)
    
    # Blink LED 3 times
    for i in range(3):
        led.on()
        time.sleep(0.5)
        led.off()
        time.sleep(0.5)
    
    blinking_active = False
    print("LED TURNED ON - PRESS NOW!")
    led.on()
    
    # Wait for button press after blinking
    start_time = time.time()
    while winner is None:
        time.sleep(0.01)

def player1_pressed():
    global winner
    
    if blinking_active:
        print("\n‚ùå PLAYER 1 PRESSED DURING BLINKING - LOSES!")
        winner = "PLAYER 2"
    elif winner is None:
        winner = "PLAYER 1"

def player2_pressed():
    global winner
    
    if blinking_active:
        print("\n‚ùå PLAYER 2 PRESSED DURING BLINKING - LOSES!")
        winner = "PLAYER 1"
    elif winner is None:
        winner = "PLAYER 2"

def main():
    print("\n" + "="*40)
    print("QUICK REACTION GAME")
    print("="*40)
    print("RULES:")
    print("1. LED blinks 3 times")
    print("2. If you press DURING blinking - YOU LOSE")
    print("3. After blinking, first press WINS")
    print("="*40)
    
    # Set button handlers
    player1_button.when_pressed = player1_pressed
    player2_button.when_pressed = player2_pressed
    
    try:
        while True:
            play_game()
            
            # Show winner
            if winner:
                print(f"\nüéâ WINNER: {winner}")
                print("="*40)
            
            # Reset LED and wait for next round
            led.off()
            time.sleep(3)
            
    except KeyboardInterrupt:
        print("\nGame stopped")
        led.off()

if __name__ == "__main__":
    main()
